{"ast":null,"code":"import { io } from 'socket.io-client';\nclass WebSocketService {\n  constructor() {\n    this.socket = null;\n    this.listeners = new Map();\n    this.isConnected = false;\n  }\n  connect(token) {\n    var _this$socket;\n    if ((_this$socket = this.socket) !== null && _this$socket !== void 0 && _this$socket.connected) {\n      return;\n    }\n    const serverUrl = process.env.REACT_APP_API_URL || 'http://localhost:5001';\n    this.socket = io(serverUrl, {\n      auth: {\n        token: token\n      },\n      transports: ['websocket', 'polling']\n    });\n    this.socket.on('connect', () => {\n      console.log('WebSocket connected');\n      this.isConnected = true;\n      this.emit('connected');\n    });\n    this.socket.on('disconnect', () => {\n      console.log('WebSocket disconnected');\n      this.isConnected = false;\n      this.emit('disconnected');\n    });\n    this.socket.on('connect_error', error => {\n      console.error('WebSocket connection error:', error);\n      this.isConnected = false;\n      this.emit('error', error);\n    });\n\n    // Listen for notifications\n    this.socket.on('notification', notification => {\n      this.emit('notification', notification);\n    });\n  }\n  disconnect() {\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = null;\n      this.isConnected = false;\n    }\n  }\n  on(event, callback) {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, []);\n    }\n    this.listeners.get(event).push(callback);\n  }\n  off(event, callback) {\n    if (this.listeners.has(event)) {\n      const callbacks = this.listeners.get(event);\n      const index = callbacks.indexOf(callback);\n      if (index > -1) {\n        callbacks.splice(index, 1);\n      }\n    }\n  }\n  emit(event, data) {\n    if (this.listeners.has(event)) {\n      this.listeners.get(event).forEach(callback => {\n        callback(data);\n      });\n    }\n  }\n  markNotificationRead(notificationId) {\n    var _this$socket2;\n    if ((_this$socket2 = this.socket) !== null && _this$socket2 !== void 0 && _this$socket2.connected) {\n      this.socket.emit('mark_notification_read', notificationId);\n    }\n  }\n}\nexport default new WebSocketService();","map":{"version":3,"names":["io","WebSocketService","constructor","socket","listeners","Map","isConnected","connect","token","_this$socket","connected","serverUrl","process","env","REACT_APP_API_URL","auth","transports","on","console","log","emit","error","notification","disconnect","event","callback","has","set","get","push","off","callbacks","index","indexOf","splice","data","forEach","markNotificationRead","notificationId","_this$socket2"],"sources":["/Users/dollarsoft/Documents/projects/personal/node/visaLink Africa/src/services/websocket.js"],"sourcesContent":["import { io } from 'socket.io-client';\n\nclass WebSocketService {\n  constructor() {\n    this.socket = null;\n    this.listeners = new Map();\n    this.isConnected = false;\n  }\n\n  connect(token) {\n    if (this.socket?.connected) {\n      return;\n    }\n\n    const serverUrl = process.env.REACT_APP_API_URL || 'http://localhost:5001';\n    \n    this.socket = io(serverUrl, {\n      auth: {\n        token: token\n      },\n      transports: ['websocket', 'polling']\n    });\n\n    this.socket.on('connect', () => {\n      console.log('WebSocket connected');\n      this.isConnected = true;\n      this.emit('connected');\n    });\n\n    this.socket.on('disconnect', () => {\n      console.log('WebSocket disconnected');\n      this.isConnected = false;\n      this.emit('disconnected');\n    });\n\n    this.socket.on('connect_error', (error) => {\n      console.error('WebSocket connection error:', error);\n      this.isConnected = false;\n      this.emit('error', error);\n    });\n\n    // Listen for notifications\n    this.socket.on('notification', (notification) => {\n      this.emit('notification', notification);\n    });\n  }\n\n  disconnect() {\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = null;\n      this.isConnected = false;\n    }\n  }\n\n  on(event, callback) {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, []);\n    }\n    this.listeners.get(event).push(callback);\n  }\n\n  off(event, callback) {\n    if (this.listeners.has(event)) {\n      const callbacks = this.listeners.get(event);\n      const index = callbacks.indexOf(callback);\n      if (index > -1) {\n        callbacks.splice(index, 1);\n      }\n    }\n  }\n\n  emit(event, data) {\n    if (this.listeners.has(event)) {\n      this.listeners.get(event).forEach(callback => {\n        callback(data);\n      });\n    }\n  }\n\n  markNotificationRead(notificationId) {\n    if (this.socket?.connected) {\n      this.socket.emit('mark_notification_read', notificationId);\n    }\n  }\n}\n\nexport default new WebSocketService();\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}