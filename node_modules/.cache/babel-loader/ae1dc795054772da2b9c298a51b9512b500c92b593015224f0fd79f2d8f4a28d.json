{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import apiService from'../../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[isAuthenticated,setIsAuthenticated]=useState(false);const[isLoading,setIsLoading]=useState(true);// Check for existing session on mount\nuseEffect(()=>{const checkAuthStatus=async()=>{try{const token=localStorage.getItem('token');if(token){// Validate token with server\nconst response=await apiService.getCurrentUser();setUser(response.user);setIsAuthenticated(true);}}catch(error){console.error('Error checking auth status:',error);localStorage.removeItem('token');localStorage.removeItem('visaLink_user');setIsAuthenticated(false);setUser(null);}finally{setIsLoading(false);}};checkAuthStatus();},[]);const login=async credentials=>{try{setIsLoading(true);const response=await apiService.login(credentials);localStorage.setItem('token',response.token);localStorage.setItem('visaLink_user',JSON.stringify(response.user));setUser(response.user);setIsAuthenticated(true);return{success:true,user:response.user};}catch(error){console.error('Login error:',error);return{success:false,error:error.message};}finally{setIsLoading(false);}};const register=async userData=>{try{setIsLoading(true);const response=await apiService.register(userData);localStorage.setItem('token',response.token);localStorage.setItem('visaLink_user',JSON.stringify(response.user));setUser(response.user);setIsAuthenticated(true);return{success:true,user:response.user};}catch(error){console.error('Registration error:',error);return{success:false,error:error.message};}finally{setIsLoading(false);}};const logout=()=>{try{localStorage.removeItem('token');localStorage.removeItem('visaLink_user');setUser(null);setIsAuthenticated(false);}catch(error){console.error('Logout error:',error);}};const updateUser=async updatedUserData=>{try{const response=await apiService.updateProfile(updatedUserData);const newUserData=response.user;localStorage.setItem('visaLink_user',JSON.stringify(newUserData));setUser(newUserData);return newUserData;}catch(error){console.error('Update user error:',error);throw error;}};const changePassword=async passwordData=>{try{await apiService.changePassword(passwordData);return{success:true};}catch(error){console.error('Change password error:',error);throw error;}};const value={user,isAuthenticated,isLoading,login,register,logout,updateUser,changePassword};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};export default AuthContext;","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","apiService","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","isAuthenticated","setIsAuthenticated","isLoading","setIsLoading","checkAuthStatus","token","localStorage","getItem","response","getCurrentUser","error","console","removeItem","login","credentials","setItem","JSON","stringify","success","message","register","userData","logout","updateUser","updatedUserData","updateProfile","newUserData","changePassword","passwordData","value","Provider"],"sources":["/Users/dollarsoft/Documents/projects/personal/node/visaLink Africa/src/components/Auth/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport apiService from '../../services/api';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Check for existing session on mount\n  useEffect(() => {\n    const checkAuthStatus = async () => {\n      try {\n        const token = localStorage.getItem('token');\n        if (token) {\n          // Validate token with server\n          const response = await apiService.getCurrentUser();\n          setUser(response.user);\n          setIsAuthenticated(true);\n        }\n      } catch (error) {\n        console.error('Error checking auth status:', error);\n        localStorage.removeItem('token');\n        localStorage.removeItem('visaLink_user');\n        setIsAuthenticated(false);\n        setUser(null);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    checkAuthStatus();\n  }, []);\n\n  const login = async (credentials) => {\n    try {\n      setIsLoading(true);\n      const response = await apiService.login(credentials);\n      \n      localStorage.setItem('token', response.token);\n      localStorage.setItem('visaLink_user', JSON.stringify(response.user));\n      setUser(response.user);\n      setIsAuthenticated(true);\n      \n      return { success: true, user: response.user };\n    } catch (error) {\n      console.error('Login error:', error);\n      return { success: false, error: error.message };\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const register = async (userData) => {\n    try {\n      setIsLoading(true);\n      const response = await apiService.register(userData);\n      \n      localStorage.setItem('token', response.token);\n      localStorage.setItem('visaLink_user', JSON.stringify(response.user));\n      setUser(response.user);\n      setIsAuthenticated(true);\n      \n      return { success: true, user: response.user };\n    } catch (error) {\n      console.error('Registration error:', error);\n      return { success: false, error: error.message };\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const logout = () => {\n    try {\n      localStorage.removeItem('token');\n      localStorage.removeItem('visaLink_user');\n      setUser(null);\n      setIsAuthenticated(false);\n    } catch (error) {\n      console.error('Logout error:', error);\n    }\n  };\n\n  const updateUser = async (updatedUserData) => {\n    try {\n      const response = await apiService.updateProfile(updatedUserData);\n      const newUserData = response.user;\n      localStorage.setItem('visaLink_user', JSON.stringify(newUserData));\n      setUser(newUserData);\n      return newUserData;\n    } catch (error) {\n      console.error('Update user error:', error);\n      throw error;\n    }\n  };\n\n  const changePassword = async (passwordData) => {\n    try {\n      await apiService.changePassword(passwordData);\n      return { success: true };\n    } catch (error) {\n      console.error('Change password error:', error);\n      throw error;\n    }\n  };\n\n  const value = {\n    user,\n    isAuthenticated,\n    isLoading,\n    login,\n    register,\n    logout,\n    updateUser,\n    changePassword\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContext;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}