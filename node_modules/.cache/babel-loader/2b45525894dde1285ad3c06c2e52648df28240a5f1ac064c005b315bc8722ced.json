{"ast":null,"code":"var _jsxFileName = \"/Users/dollarsoft/Documents/projects/personal/node/visaLink Africa/src/contexts/NotificationContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\nimport { useAuth } from '../components/Auth/AuthContext';\nimport websocketService from '../services/websocket';\nimport { toast } from 'react-toastify';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst NotificationContext = /*#__PURE__*/createContext();\nexport const useNotifications = () => {\n  _s();\n  const context = useContext(NotificationContext);\n  if (!context) {\n    throw new Error('useNotifications must be used within a NotificationProvider');\n  }\n  return context;\n};\n_s(useNotifications, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const NotificationProvider = ({\n  children\n}) => {\n  _s2();\n  const {\n    user,\n    isAuthenticated\n  } = useAuth();\n  const [notifications, setNotifications] = useState([]);\n  const [unreadCount, setUnreadCount] = useState(0);\n\n  // Format timestamp to relative time\n  const formatTimestamp = timestamp => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffInSeconds = Math.floor((now - date) / 1000);\n    if (diffInSeconds < 60) {\n      return 'Just now';\n    } else if (diffInSeconds < 3600) {\n      const minutes = Math.floor(diffInSeconds / 60);\n      return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;\n    } else if (diffInSeconds < 86400) {\n      const hours = Math.floor(diffInSeconds / 3600);\n      return `${hours} hour${hours > 1 ? 's' : ''} ago`;\n    } else {\n      const days = Math.floor(diffInSeconds / 86400);\n      return `${days} day${days > 1 ? 's' : ''} ago`;\n    }\n  };\n\n  // Get icon and color based on notification type\n  const getNotificationStyle = type => {\n    switch (type) {\n      case 'success':\n        return {\n          icon: 'CheckCircle',\n          color: 'text-green-600',\n          bgColor: 'bg-green-50'\n        };\n      case 'error':\n        return {\n          icon: 'AlertCircle',\n          color: 'text-red-600',\n          bgColor: 'bg-red-50'\n        };\n      case 'warning':\n        return {\n          icon: 'AlertTriangle',\n          color: 'text-yellow-600',\n          bgColor: 'bg-yellow-50'\n        };\n      default:\n        return {\n          icon: 'Info',\n          color: 'text-blue-600',\n          bgColor: 'bg-blue-50'\n        };\n    }\n  };\n\n  // Handle new notification\n  const handleNewNotification = useCallback(notification => {\n    const formattedNotification = {\n      ...notification,\n      timestamp: formatTimestamp(notification.timestamp),\n      formattedDate: new Date(notification.timestamp).toLocaleString(),\n      ...getNotificationStyle(notification.type)\n    };\n    setNotifications(prev => [formattedNotification, ...prev]);\n    setUnreadCount(prev => prev + 1);\n\n    // Show toast notification\n    const toastOptions = {\n      position: 'top-right',\n      autoClose: 5000,\n      hideProgressBar: false,\n      closeOnClick: true,\n      pauseOnHover: true,\n      draggable: true\n    };\n    switch (notification.type) {\n      case 'success':\n        toast.success(notification.message, {\n          ...toastOptions,\n          title: notification.title\n        });\n        break;\n      case 'error':\n        toast.error(notification.message, {\n          ...toastOptions,\n          title: notification.title\n        });\n        break;\n      case 'warning':\n        toast.warning(notification.message, {\n          ...toastOptions,\n          title: notification.title\n        });\n        break;\n      default:\n        toast.info(notification.message, {\n          ...toastOptions,\n          title: notification.title\n        });\n    }\n  }, []);\n\n  // Connect WebSocket when user is authenticated\n  useEffect(() => {\n    if (isAuthenticated && user) {\n      const token = localStorage.getItem('token');\n      if (token) {\n        websocketService.connect(token);\n\n        // Listen for notifications\n        websocketService.on('notification', handleNewNotification);\n        return () => {\n          websocketService.off('notification', handleNewNotification);\n        };\n      }\n    } else {\n      websocketService.disconnect();\n      setNotifications([]);\n      setUnreadCount(0);\n    }\n  }, [isAuthenticated, user, handleNewNotification]);\n  const markAsRead = notificationId => {\n    setNotifications(prev => prev.map(notification => notification.id === notificationId ? {\n      ...notification,\n      read: true\n    } : notification));\n    setUnreadCount(prev => Math.max(0, prev - 1));\n    websocketService.markNotificationRead(notificationId);\n  };\n  const markAllAsRead = () => {\n    setNotifications(prev => prev.map(notification => ({\n      ...notification,\n      read: true\n    })));\n    setUnreadCount(0);\n  };\n  const deleteNotification = notificationId => {\n    setNotifications(prev => {\n      const notification = prev.find(n => n.id === notificationId);\n      if (notification && !notification.read) {\n        setUnreadCount(count => Math.max(0, count - 1));\n      }\n      return prev.filter(notification => notification.id !== notificationId);\n    });\n  };\n  const clearAll = () => {\n    setNotifications([]);\n    setUnreadCount(0);\n  };\n  const value = {\n    notifications,\n    unreadCount,\n    markAsRead,\n    markAllAsRead,\n    deleteNotification,\n    clearAll\n  };\n  return /*#__PURE__*/_jsxDEV(NotificationContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 157,\n    columnNumber: 5\n  }, this);\n};\n_s2(NotificationProvider, \"hex3T6xXkayVc5UrWGYYkKGy4uQ=\", false, function () {\n  return [useAuth];\n});\n_c = NotificationProvider;\nexport default NotificationContext;\nvar _c;\n$RefreshReg$(_c, \"NotificationProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","useCallback","useAuth","websocketService","toast","jsxDEV","_jsxDEV","NotificationContext","useNotifications","_s","context","Error","NotificationProvider","children","_s2","user","isAuthenticated","notifications","setNotifications","unreadCount","setUnreadCount","formatTimestamp","timestamp","date","Date","now","diffInSeconds","Math","floor","minutes","hours","days","getNotificationStyle","type","icon","color","bgColor","handleNewNotification","notification","formattedNotification","formattedDate","toLocaleString","prev","toastOptions","position","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","success","message","title","error","warning","info","token","localStorage","getItem","connect","on","off","disconnect","markAsRead","notificationId","map","id","read","max","markNotificationRead","markAllAsRead","deleteNotification","find","n","count","filter","clearAll","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/dollarsoft/Documents/projects/personal/node/visaLink Africa/src/contexts/NotificationContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\nimport { useAuth } from '../components/Auth/AuthContext';\nimport websocketService from '../services/websocket';\nimport { toast } from 'react-toastify';\n\nconst NotificationContext = createContext();\n\nexport const useNotifications = () => {\n  const context = useContext(NotificationContext);\n  if (!context) {\n    throw new Error('useNotifications must be used within a NotificationProvider');\n  }\n  return context;\n};\n\nexport const NotificationProvider = ({ children }) => {\n  const { user, isAuthenticated } = useAuth();\n  const [notifications, setNotifications] = useState([]);\n  const [unreadCount, setUnreadCount] = useState(0);\n\n  // Format timestamp to relative time\n  const formatTimestamp = (timestamp) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffInSeconds = Math.floor((now - date) / 1000);\n\n    if (diffInSeconds < 60) {\n      return 'Just now';\n    } else if (diffInSeconds < 3600) {\n      const minutes = Math.floor(diffInSeconds / 60);\n      return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;\n    } else if (diffInSeconds < 86400) {\n      const hours = Math.floor(diffInSeconds / 3600);\n      return `${hours} hour${hours > 1 ? 's' : ''} ago`;\n    } else {\n      const days = Math.floor(diffInSeconds / 86400);\n      return `${days} day${days > 1 ? 's' : ''} ago`;\n    }\n  };\n\n  // Get icon and color based on notification type\n  const getNotificationStyle = (type) => {\n    switch (type) {\n      case 'success':\n        return { icon: 'CheckCircle', color: 'text-green-600', bgColor: 'bg-green-50' };\n      case 'error':\n        return { icon: 'AlertCircle', color: 'text-red-600', bgColor: 'bg-red-50' };\n      case 'warning':\n        return { icon: 'AlertTriangle', color: 'text-yellow-600', bgColor: 'bg-yellow-50' };\n      default:\n        return { icon: 'Info', color: 'text-blue-600', bgColor: 'bg-blue-50' };\n    }\n  };\n\n  // Handle new notification\n  const handleNewNotification = useCallback((notification) => {\n    const formattedNotification = {\n      ...notification,\n      timestamp: formatTimestamp(notification.timestamp),\n      formattedDate: new Date(notification.timestamp).toLocaleString(),\n      ...getNotificationStyle(notification.type)\n    };\n\n    setNotifications(prev => [formattedNotification, ...prev]);\n    setUnreadCount(prev => prev + 1);\n\n    // Show toast notification\n    const toastOptions = {\n      position: 'top-right',\n      autoClose: 5000,\n      hideProgressBar: false,\n      closeOnClick: true,\n      pauseOnHover: true,\n      draggable: true,\n    };\n\n    switch (notification.type) {\n      case 'success':\n        toast.success(notification.message, { ...toastOptions, title: notification.title });\n        break;\n      case 'error':\n        toast.error(notification.message, { ...toastOptions, title: notification.title });\n        break;\n      case 'warning':\n        toast.warning(notification.message, { ...toastOptions, title: notification.title });\n        break;\n      default:\n        toast.info(notification.message, { ...toastOptions, title: notification.title });\n    }\n  }, []);\n\n  // Connect WebSocket when user is authenticated\n  useEffect(() => {\n    if (isAuthenticated && user) {\n      const token = localStorage.getItem('token');\n      if (token) {\n        websocketService.connect(token);\n\n        // Listen for notifications\n        websocketService.on('notification', handleNewNotification);\n\n        return () => {\n          websocketService.off('notification', handleNewNotification);\n        };\n      }\n    } else {\n      websocketService.disconnect();\n      setNotifications([]);\n      setUnreadCount(0);\n    }\n  }, [isAuthenticated, user, handleNewNotification]);\n\n  const markAsRead = (notificationId) => {\n    setNotifications(prev =>\n      prev.map(notification =>\n        notification.id === notificationId\n          ? { ...notification, read: true }\n          : notification\n      )\n    );\n    setUnreadCount(prev => Math.max(0, prev - 1));\n    websocketService.markNotificationRead(notificationId);\n  };\n\n  const markAllAsRead = () => {\n    setNotifications(prev =>\n      prev.map(notification => ({ ...notification, read: true }))\n    );\n    setUnreadCount(0);\n  };\n\n  const deleteNotification = (notificationId) => {\n    setNotifications(prev => {\n      const notification = prev.find(n => n.id === notificationId);\n      if (notification && !notification.read) {\n        setUnreadCount(count => Math.max(0, count - 1));\n      }\n      return prev.filter(notification => notification.id !== notificationId);\n    });\n  };\n\n  const clearAll = () => {\n    setNotifications([]);\n    setUnreadCount(0);\n  };\n\n  const value = {\n    notifications,\n    unreadCount,\n    markAsRead,\n    markAllAsRead,\n    deleteNotification,\n    clearAll\n  };\n\n  return (\n    <NotificationContext.Provider value={value}>\n      {children}\n    </NotificationContext.Provider>\n  );\n};\n\nexport default NotificationContext;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}